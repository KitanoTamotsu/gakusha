## 　　Lesson33.スクリプトフィルターを2段階で使う
#### 開発メモ
### 1.Gaku-Shaを知ろう
　雑学サイトGaku-Sha。トップページは最近の記事が表示されています
<br>　かなりの頻度で更新していますね
<br>　右側にカテゴリがあり、記事数が表示されています。使えそうですね
<br>　クリックしてみるとトップページ同様の記事の一覧です
<br>　1ページ24件ですね
<br>　カテゴリ同様に目的別というインデックスもあるようです
<br>　人気の記事はタブ切り替えで5件なので扱いにくいです
<br>　
<br>　Alfredにするなら、はじめにカテゴリ・目的別のインデックスから範囲をえらんで
<br>　次にランダムに表示させることができそうです

### 2.フローの構成
　そこで、今回は、2段階のScriptFilterにしてみました
<br>　はじめはトップページの左側のカテゴリと目的別を抽出しましょう
<br>　件数の表示が独特な部分から当たりをつけると、すぐにSpan class="count"を発見
<br>　grepとsedで切り取ります
<br>　いつもはtitleやurlといった要素ごとに配列化しますが
<br>　今回は一度で配列化しました
<br>　sedの出力を\1 \3 \2というようにすればOKです
<br>　この部分は簡単なのですが
<br>　JSONを作成するときに配列の数字だらけになるのでわかりにくいです
<br>　
<br>　単なる気まぐれですが、titleに記事数を括弧でつけています
<br>　argにはURLと記事数を"_"でつなげています。こちらは気まぐれではなく、後続で利用します
<br>　
<br>　あと、JSONの出力をスクロールさせたくなかったので9行としています
<br>　そのためshuf&headでランダムに選択しています
<br>　
<br>　
### 3.2段目のScriptFilter
　2段目のScriptFilterはカテゴリ内のページをランダムで選択。
<br>　そのページにある記事（基本的に24個）から9件をランダムに選んでJSONフォーマットで出力します
<br>　まずは1段目から受け渡ってくるURLと記事数を分離させます
<br>　記事数によってページのURLを生成します
<br>　1ページ目の場合は受け渡しURLのまま、2ページ移行はそのURLに/page/nを追加します
<br>　もともと24件未満で1ページになってしまう場合と
<br>　複数ページから選択して、たまたま1ページを選択する場合があり
<br>　ロジックがエレガントでないのですね。。。
<br>　
<br>　ページのURLがきまったらcURLでソースを取得して
<br>　記事のタイトルとURLを配列に格納。あとは9件を選択してJSONにするだけ
<br>　
#### 背景
　しばらくワークフローを作っていなかったのですが、鈍らないようにと作成してみました　
<br>　雑学をランダム表示させようと思いサーフィンしていたらGaku-Sha.comを見つけました
<br>　2000を超える雑学で、1つが数百字程度となかなか手頃
<br>　URLには数字を使っていないので、カテゴリを解析しながら、ランダム表示です 　

#### 取扱説明
### 機能:
　Gaku-Sha.comサイトの雑学をランダムに表示する
### インストール:
　1.[alfredworkflow](https://github.com/KitanoTamotsu/gakusha/Gaku-Sha.com.alfredworkflow.zip)をダウンロード 
<br>　2.ファイルをダブルクリックしてワークフローに登録

### 使い方:
　Alfredからキーワード『gakusha』で起動
<br>
<br>
[トップページに戻る](https://kitanotamotsu.github.io/)

